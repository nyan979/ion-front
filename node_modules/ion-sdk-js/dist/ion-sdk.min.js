var IonSDK=function(g){var I={};function C(A){if(I[A])return I[A].exports;var n=I[A]={i:A,l:!1,exports:{}};return g[A].call(n.exports,n,n.exports,C),n.l=!0,n.exports}return C.m=g,C.c=I,C.d=function(g,I,A){C.o(g,I)||Object.defineProperty(g,I,{enumerable:!0,get:A})},C.r=function(g){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(g,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(g,"__esModule",{value:!0})},C.t=function(g,I){if(1&I&&(g=C(g)),8&I)return g;if(4&I&&"object"==typeof g&&g&&g.__esModule)return g;var A=Object.create(null);if(C.r(A),Object.defineProperty(A,"default",{enumerable:!0,value:g}),2&I&&"string"!=typeof g)for(var n in g)C.d(A,n,function(I){return g[I]}.bind(null,n));return A},C.n=function(g){var I=g&&g.__esModule?function(){return g.default}:function(){return g};return C.d(I,"a",I),I},C.o=function(g,I){return Object.prototype.hasOwnProperty.call(g,I)},C.p="",C(C.s=1)}([function(module,exports,__webpack_require__){"use strict";eval("\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.makeRemote = exports.LocalStream = exports.VideoConstraints = void 0;\nconst resolutions = ['qvga', 'vga', 'shd', 'hd', 'fhd', 'qhd'];\nexports.VideoConstraints = {\n    qvga: {\n        resolution: {\n            width: { ideal: 320 },\n            height: { ideal: 180 },\n            frameRate: {\n                ideal: 15,\n                max: 30,\n            },\n        },\n        encodings: {\n            maxBitrate: 150000,\n            maxFramerate: 15.0,\n        },\n    },\n    vga: {\n        resolution: {\n            width: { ideal: 640 },\n            height: { ideal: 360 },\n            frameRate: {\n                ideal: 30,\n                max: 60,\n            },\n        },\n        encodings: {\n            maxBitrate: 500000,\n            maxFramerate: 30.0,\n        },\n    },\n    shd: {\n        resolution: {\n            width: { ideal: 960 },\n            height: { ideal: 540 },\n            frameRate: {\n                ideal: 30,\n                max: 60,\n            },\n        },\n        encodings: {\n            maxBitrate: 1200000,\n            maxFramerate: 30.0,\n        },\n    },\n    hd: {\n        resolution: {\n            width: { ideal: 1280 },\n            height: { ideal: 720 },\n            frameRate: {\n                ideal: 30,\n                max: 60,\n            },\n        },\n        encodings: {\n            maxBitrate: 2500000,\n            maxFramerate: 30.0,\n        },\n    },\n    fhd: {\n        resolution: {\n            width: { ideal: 1920 },\n            height: { ideal: 1080 },\n            frameRate: {\n                ideal: 30,\n                max: 60,\n            },\n        },\n        encodings: {\n            maxBitrate: 4000000,\n            maxFramerate: 30.0,\n        },\n    },\n    qhd: {\n        resolution: {\n            width: { ideal: 2560 },\n            height: { ideal: 1440 },\n            frameRate: {\n                ideal: 30,\n                max: 60,\n            },\n        },\n        encodings: {\n            maxBitrate: 8000000,\n            maxFramerate: 30.0,\n        },\n    },\n};\nconst defaults = {\n    resolution: 'hd',\n    codec: 'vp8',\n    audio: true,\n    video: true,\n    simulcast: false,\n};\nclass LocalStream extends MediaStream {\n    constructor(stream, constraints) {\n        super(stream);\n        this.constraints = constraints;\n    }\n    static async getUserMedia(constraints = defaults) {\n        const stream = await navigator.mediaDevices.getUserMedia({\n            audio: LocalStream.computeAudioConstraints({\n                ...defaults,\n                ...constraints,\n            }),\n            video: LocalStream.computeVideoConstraints({\n                ...defaults,\n                ...constraints,\n            }),\n        });\n        return new LocalStream(stream, {\n            ...defaults,\n            ...constraints,\n        });\n    }\n    static async getDisplayMedia(constraints = {\n        codec: 'vp8',\n        resolution: 'hd',\n        audio: false,\n        video: true,\n        simulcast: false,\n    }) {\n        // @ts-ignore\n        const stream = await navigator.mediaDevices.getDisplayMedia(constraints);\n        return new LocalStream(stream, {\n            ...defaults,\n            ...constraints,\n        });\n    }\n    static computeAudioConstraints(constraints) {\n        return constraints.audio;\n    }\n    static computeVideoConstraints(constraints) {\n        if (constraints.video instanceof Object) {\n            return constraints.video;\n        }\n        else if (constraints.video && constraints.resolution) {\n            return {\n                ...exports.VideoConstraints[constraints.resolution].resolution,\n            };\n        }\n        return constraints.video;\n    }\n    getTrack(kind) {\n        let tracks;\n        if (kind === 'video') {\n            tracks = this.getVideoTracks();\n            return tracks.length > 0 ? this.getVideoTracks()[0] : undefined;\n        }\n        tracks = this.getAudioTracks();\n        return tracks.length > 0 ? this.getAudioTracks()[0] : undefined;\n    }\n    async getNewTrack(kind) {\n        const stream = await navigator.mediaDevices.getUserMedia({\n            [kind]: kind === 'video'\n                ? LocalStream.computeVideoConstraints(this.constraints)\n                : LocalStream.computeAudioConstraints(this.constraints),\n        });\n        return stream.getTracks()[0];\n    }\n    publishTrack(track) {\n        if (this.pc) {\n            const init = {\n                streams: [this],\n                direction: 'sendonly',\n            };\n            if (track.kind === 'video') {\n                if (this.encodingParams) {\n                    init.sendEncodings = this.encodingParams;\n                }\n                else if (this.constraints.simulcast) {\n                    const idx = resolutions.indexOf(this.constraints.resolution);\n                    const encodings = [\n                        {\n                            rid: 'f',\n                            maxBitrate: exports.VideoConstraints[resolutions[idx]].encodings.maxBitrate,\n                            maxFramerate: exports.VideoConstraints[resolutions[idx]].encodings.maxFramerate,\n                        },\n                    ];\n                    if (idx - 1 >= 0) {\n                        encodings.push({\n                            rid: 'h',\n                            scaleResolutionDownBy: 2.0,\n                            maxBitrate: exports.VideoConstraints[resolutions[idx - 1]].encodings.maxBitrate,\n                            maxFramerate: exports.VideoConstraints[resolutions[idx - 1]].encodings.maxFramerate,\n                        });\n                    }\n                    if (idx - 2 >= 0) {\n                        encodings.push({\n                            rid: 'q',\n                            scaleResolutionDownBy: 4.0,\n                            maxBitrate: exports.VideoConstraints[resolutions[idx - 2]].encodings.maxBitrate,\n                            maxFramerate: exports.VideoConstraints[resolutions[idx - 2]].encodings.maxFramerate,\n                        });\n                    }\n                    init.sendEncodings = encodings;\n                }\n                else {\n                    init.sendEncodings = [exports.VideoConstraints[this.constraints.resolution].encodings];\n                }\n            }\n            const transceiver = this.pc.addTransceiver(track, init);\n            this.setPreferredCodec(transceiver, track.kind);\n        }\n    }\n    setPreferredCodec(transceiver, kind) {\n        if ('setCodecPreferences' in transceiver) {\n            const cap = RTCRtpSender.getCapabilities(kind);\n            if (!cap)\n                return;\n            let selCodec;\n            if (this.constraints.preferredCodecProfile && kind === 'video') {\n                const allCodecProfiles = cap.codecs.filter((c) => c.mimeType.toLowerCase() === `video/${this.constraints.codec.toLowerCase()}`);\n                if (!allCodecProfiles) {\n                    return;\n                }\n                selCodec = allCodecProfiles.find((c) => { var _a; return c.sdpFmtpLine && ((_a = c.sdpFmtpLine) === null || _a === void 0 ? void 0 : _a.indexOf(`profile-level-id=${this.constraints.preferredCodecProfile}`)) >= 0; });\n                if (!selCodec) {\n                    // get first one\n                    selCodec = allCodecProfiles[0];\n                }\n            }\n            else {\n                selCodec = cap.codecs.find((c) => c.mimeType.toLowerCase() === `video/${this.constraints.codec.toLowerCase()}` ||\n                    c.mimeType.toLowerCase() === `audio/opus`);\n            }\n            if (selCodec) {\n                transceiver.setCodecPreferences([selCodec]);\n            }\n        }\n    }\n    updateTrack(next, prev) {\n        this.addTrack(next);\n        // If published, replace published track with track from new device\n        if (prev) {\n            this.removeTrack(prev);\n            prev.stop();\n            if (this.pc) {\n                this.pc.getSenders().forEach(async (sender) => {\n                    var _a, _b;\n                    if (((_a = sender === null || sender === void 0 ? void 0 : sender.track) === null || _a === void 0 ? void 0 : _a.kind) === next.kind) {\n                        (_b = sender.track) === null || _b === void 0 ? void 0 : _b.stop();\n                        sender.replaceTrack(next);\n                    }\n                });\n            }\n        }\n        else {\n            if (this.pc) {\n                this.publishTrack(next);\n            }\n        }\n    }\n    initAudioEmptyTrack() {\n        // @ts-ignore\n        const AudioContext = window.AudioContext || window.webkitAudioContext;\n        const ctx = new AudioContext();\n        const oscillator = ctx.createOscillator();\n        oscillator.frequency.setValueAtTime(20000, ctx.currentTime);\n        const dst = oscillator.connect(ctx.createMediaStreamDestination());\n        oscillator.start();\n        return dst.stream.getAudioTracks()[0];\n    }\n    initVideoEmptyTrack(width, height) {\n        var _a;\n        const canvas = Object.assign(document.createElement('canvas'), { width, height });\n        (_a = canvas.getContext('2d')) === null || _a === void 0 ? void 0 : _a.fillRect(0, 0, width, height);\n        const stream = canvas.captureStream();\n        return stream.getVideoTracks()[0];\n    }\n    publish(transport, encodingParams) {\n        this.pc = transport.pc;\n        this.api = transport.api;\n        this.encodingParams = encodingParams;\n        this.getTracks().forEach(this.publishTrack.bind(this));\n    }\n    unpublish() {\n        if (this.pc) {\n            const tracks = this.getTracks();\n            this.pc.getSenders().forEach((s) => {\n                if (s.track && tracks.includes(s.track)) {\n                    this.pc.removeTrack(s);\n                }\n            });\n        }\n    }\n    async switchDevice(kind, deviceId) {\n        this.constraints = {\n            ...this.constraints,\n            [kind]: this.constraints[kind] instanceof Object\n                ? {\n                    ...this.constraints[kind],\n                    deviceId,\n                }\n                : { deviceId },\n        };\n        const prev = this.getTrack(kind);\n        // Firefox/Safari have issues when multiple input devices are used by same origin. We need to stop previous track before creating new one.\n        if (prev)\n            prev.stop();\n        const next = await this.getNewTrack(kind);\n        this.updateTrack(next, prev);\n    }\n    mute(kind) {\n        const track = this.getTrack(kind);\n        if (track && this.constraints.sendEmptyOnMute) {\n            const emptyTrack = kind === 'audio'\n                ? this.initAudioEmptyTrack()\n                : this.initVideoEmptyTrack((track === null || track === void 0 ? void 0 : track.getSettings().width) || 640, (track === null || track === void 0 ? void 0 : track.getSettings().height) || 360);\n            emptyTrack.enabled = false;\n            this.updateTrack(emptyTrack, track);\n            return;\n        }\n        if (track) {\n            track.stop();\n        }\n    }\n    async unmute(kind) {\n        const prev = this.getTrack(kind);\n        const track = await this.getNewTrack(kind);\n        this.updateTrack(track, prev);\n    }\n    async enableLayers(layers) {\n        const call = {\n            streamId: this.id,\n            layers,\n        };\n        const callStr = JSON.stringify(call);\n        if (this.api) {\n            if (this.api.readyState !== 'open') {\n                // queue call if we aren't open yet\n                this.api.onopen = () => { var _a; return (_a = this.api) === null || _a === void 0 ? void 0 : _a.send(JSON.stringify(call)); };\n            }\n            else {\n                this.api.send(JSON.stringify(call));\n            }\n        }\n        const layerValues = ['high', 'medium', 'low'];\n        await Promise.all(layerValues.map(async (layer) => {\n            await this.updateMediaEncodingParams({ active: layers.includes(layer) }, layer);\n        }));\n    }\n    async updateMediaEncodingParams(encodingParams, layer) {\n        var _a;\n        if (!this.pc)\n            return;\n        const tracks = this.getTracks();\n        await Promise.all((_a = this.pc) === null || _a === void 0 ? void 0 : _a.getSenders().filter((sender) => sender.track && tracks.includes(sender.track)).map(async (sender) => {\n            const params = sender.getParameters();\n            if (!params.encodings) {\n                params.encodings = [{}];\n            }\n            let idx = 0;\n            if (this.constraints.simulcast && layer) {\n                const rid = layer === 'high' ? 'f' : layer === 'medium' ? 'h' : 'q';\n                idx = params.encodings.findIndex((encoding) => encoding.rid === rid);\n                if (params.encodings.length < idx + 1)\n                    return;\n            }\n            params.encodings[idx] = {\n                ...params.encodings[idx],\n                ...encodingParams,\n            };\n            await sender.setParameters(params);\n        }));\n    }\n}\nexports.LocalStream = LocalStream;\nfunction makeRemote(stream, transport) {\n    const remote = stream;\n    remote.audio = true;\n    remote.video = 'none';\n    remote.framerate = 'high';\n    remote._videoPreMute = 'high';\n    const select = () => {\n        const call = {\n            streamId: remote.id,\n            video: remote.video,\n            audio: remote.audio,\n            framerate: remote.framerate,\n        };\n        if (transport.api) {\n            if (transport.api.readyState !== 'open') {\n                // queue call if we aren't open yet\n                transport.api.onopen = () => { var _a; return (_a = transport.api) === null || _a === void 0 ? void 0 : _a.send(JSON.stringify(call)); };\n            }\n            else {\n                transport.api.send(JSON.stringify(call));\n            }\n        }\n    };\n    remote.preferLayer = (layer) => {\n        remote.video = layer;\n        select();\n    };\n    remote.preferFramerate = (layer) => {\n        remote.framerate = layer;\n        select();\n    };\n    remote.mute = (kind) => {\n        if (kind === 'audio') {\n            remote.audio = false;\n        }\n        else if (kind === 'video') {\n            remote._videoPreMute = remote.video;\n            remote.video = 'none';\n        }\n        select();\n    };\n    remote.unmute = (kind) => {\n        if (kind === 'audio') {\n            remote.audio = true;\n        }\n        else if (kind === 'video') {\n            remote.video = remote._videoPreMute;\n        }\n        select();\n    };\n    return remote;\n}\nexports.makeRemote = makeRemote;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9Jb25TREsvLi9zcmMvc3RyZWFtLnRzP2U2ZGYiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBOEMsY0FBYztBQUM1RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLGFBQWE7QUFDakMscUJBQXFCLGFBQWE7QUFDbEM7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1QsS0FBSztBQUNMO0FBQ0E7QUFDQSxvQkFBb0IsYUFBYTtBQUNqQyxxQkFBcUIsYUFBYTtBQUNsQztBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxLQUFLO0FBQ0w7QUFDQTtBQUNBLG9CQUFvQixhQUFhO0FBQ2pDLHFCQUFxQixhQUFhO0FBQ2xDO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULEtBQUs7QUFDTDtBQUNBO0FBQ0Esb0JBQW9CLGNBQWM7QUFDbEMscUJBQXFCLGFBQWE7QUFDbEM7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1QsS0FBSztBQUNMO0FBQ0E7QUFDQSxvQkFBb0IsY0FBYztBQUNsQyxxQkFBcUIsY0FBYztBQUNuQztBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxLQUFLO0FBQ0w7QUFDQTtBQUNBLG9CQUFvQixjQUFjO0FBQ2xDLHFCQUFxQixjQUFjO0FBQ25DO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdHQUF3RyxxQ0FBcUM7QUFDN0k7QUFDQTtBQUNBO0FBQ0EseURBQXlELFFBQVEsbUhBQW1ILHVDQUF1QyxTQUFTLEVBQUU7QUFDdE87QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0ZBQXdGLHFDQUFxQztBQUM3SDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3RUFBd0UsZ0JBQWdCO0FBQ3hGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQkFBbUIsV0FBVztBQUM5QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5Q0FBeUMsUUFBUSwyRkFBMkY7QUFDNUk7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrREFBa0QsaUNBQWlDO0FBQ25GLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQ0FBc0M7QUFDdEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4Q0FBOEMsUUFBUSxnR0FBZ0c7QUFDdEo7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6IjAuanMiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMubWFrZVJlbW90ZSA9IGV4cG9ydHMuTG9jYWxTdHJlYW0gPSBleHBvcnRzLlZpZGVvQ29uc3RyYWludHMgPSB2b2lkIDA7XG5jb25zdCByZXNvbHV0aW9ucyA9IFsncXZnYScsICd2Z2EnLCAnc2hkJywgJ2hkJywgJ2ZoZCcsICdxaGQnXTtcbmV4cG9ydHMuVmlkZW9Db25zdHJhaW50cyA9IHtcbiAgICBxdmdhOiB7XG4gICAgICAgIHJlc29sdXRpb246IHtcbiAgICAgICAgICAgIHdpZHRoOiB7IGlkZWFsOiAzMjAgfSxcbiAgICAgICAgICAgIGhlaWdodDogeyBpZGVhbDogMTgwIH0sXG4gICAgICAgICAgICBmcmFtZVJhdGU6IHtcbiAgICAgICAgICAgICAgICBpZGVhbDogMTUsXG4gICAgICAgICAgICAgICAgbWF4OiAzMCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIGVuY29kaW5nczoge1xuICAgICAgICAgICAgbWF4Qml0cmF0ZTogMTUwMDAwLFxuICAgICAgICAgICAgbWF4RnJhbWVyYXRlOiAxNS4wLFxuICAgICAgICB9LFxuICAgIH0sXG4gICAgdmdhOiB7XG4gICAgICAgIHJlc29sdXRpb246IHtcbiAgICAgICAgICAgIHdpZHRoOiB7IGlkZWFsOiA2NDAgfSxcbiAgICAgICAgICAgIGhlaWdodDogeyBpZGVhbDogMzYwIH0sXG4gICAgICAgICAgICBmcmFtZVJhdGU6IHtcbiAgICAgICAgICAgICAgICBpZGVhbDogMzAsXG4gICAgICAgICAgICAgICAgbWF4OiA2MCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIGVuY29kaW5nczoge1xuICAgICAgICAgICAgbWF4Qml0cmF0ZTogNTAwMDAwLFxuICAgICAgICAgICAgbWF4RnJhbWVyYXRlOiAzMC4wLFxuICAgICAgICB9LFxuICAgIH0sXG4gICAgc2hkOiB7XG4gICAgICAgIHJlc29sdXRpb246IHtcbiAgICAgICAgICAgIHdpZHRoOiB7IGlkZWFsOiA5NjAgfSxcbiAgICAgICAgICAgIGhlaWdodDogeyBpZGVhbDogNTQwIH0sXG4gICAgICAgICAgICBmcmFtZVJhdGU6IHtcbiAgICAgICAgICAgICAgICBpZGVhbDogMzAsXG4gICAgICAgICAgICAgICAgbWF4OiA2MCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIGVuY29kaW5nczoge1xuICAgICAgICAgICAgbWF4Qml0cmF0ZTogMTIwMDAwMCxcbiAgICAgICAgICAgIG1heEZyYW1lcmF0ZTogMzAuMCxcbiAgICAgICAgfSxcbiAgICB9LFxuICAgIGhkOiB7XG4gICAgICAgIHJlc29sdXRpb246IHtcbiAgICAgICAgICAgIHdpZHRoOiB7IGlkZWFsOiAxMjgwIH0sXG4gICAgICAgICAgICBoZWlnaHQ6IHsgaWRlYWw6IDcyMCB9LFxuICAgICAgICAgICAgZnJhbWVSYXRlOiB7XG4gICAgICAgICAgICAgICAgaWRlYWw6IDMwLFxuICAgICAgICAgICAgICAgIG1heDogNjAsXG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICBlbmNvZGluZ3M6IHtcbiAgICAgICAgICAgIG1heEJpdHJhdGU6IDI1MDAwMDAsXG4gICAgICAgICAgICBtYXhGcmFtZXJhdGU6IDMwLjAsXG4gICAgICAgIH0sXG4gICAgfSxcbiAgICBmaGQ6IHtcbiAgICAgICAgcmVzb2x1dGlvbjoge1xuICAgICAgICAgICAgd2lkdGg6IHsgaWRlYWw6IDE5MjAgfSxcbiAgICAgICAgICAgIGhlaWdodDogeyBpZGVhbDogMTA4MCB9LFxuICAgICAgICAgICAgZnJhbWVSYXRlOiB7XG4gICAgICAgICAgICAgICAgaWRlYWw6IDMwLFxuICAgICAgICAgICAgICAgIG1heDogNjAsXG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICBlbmNvZGluZ3M6IHtcbiAgICAgICAgICAgIG1heEJpdHJhdGU6IDQwMDAwMDAsXG4gICAgICAgICAgICBtYXhGcmFtZXJhdGU6IDMwLjAsXG4gICAgICAgIH0sXG4gICAgfSxcbiAgICBxaGQ6IHtcbiAgICAgICAgcmVzb2x1dGlvbjoge1xuICAgICAgICAgICAgd2lkdGg6IHsgaWRlYWw6IDI1NjAgfSxcbiAgICAgICAgICAgIGhlaWdodDogeyBpZGVhbDogMTQ0MCB9LFxuICAgICAgICAgICAgZnJhbWVSYXRlOiB7XG4gICAgICAgICAgICAgICAgaWRlYWw6IDMwLFxuICAgICAgICAgICAgICAgIG1heDogNjAsXG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICBlbmNvZGluZ3M6IHtcbiAgICAgICAgICAgIG1heEJpdHJhdGU6IDgwMDAwMDAsXG4gICAgICAgICAgICBtYXhGcmFtZXJhdGU6IDMwLjAsXG4gICAgICAgIH0sXG4gICAgfSxcbn07XG5jb25zdCBkZWZhdWx0cyA9IHtcbiAgICByZXNvbHV0aW9uOiAnaGQnLFxuICAgIGNvZGVjOiAndnA4JyxcbiAgICBhdWRpbzogdHJ1ZSxcbiAgICB2aWRlbzogdHJ1ZSxcbiAgICBzaW11bGNhc3Q6IGZhbHNlLFxufTtcbmNsYXNzIExvY2FsU3RyZWFtIGV4dGVuZHMgTWVkaWFTdHJlYW0ge1xuICAgIGNvbnN0cnVjdG9yKHN0cmVhbSwgY29uc3RyYWludHMpIHtcbiAgICAgICAgc3VwZXIoc3RyZWFtKTtcbiAgICAgICAgdGhpcy5jb25zdHJhaW50cyA9IGNvbnN0cmFpbnRzO1xuICAgIH1cbiAgICBzdGF0aWMgYXN5bmMgZ2V0VXNlck1lZGlhKGNvbnN0cmFpbnRzID0gZGVmYXVsdHMpIHtcbiAgICAgICAgY29uc3Qgc3RyZWFtID0gYXdhaXQgbmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5nZXRVc2VyTWVkaWEoe1xuICAgICAgICAgICAgYXVkaW86IExvY2FsU3RyZWFtLmNvbXB1dGVBdWRpb0NvbnN0cmFpbnRzKHtcbiAgICAgICAgICAgICAgICAuLi5kZWZhdWx0cyxcbiAgICAgICAgICAgICAgICAuLi5jb25zdHJhaW50cyxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgdmlkZW86IExvY2FsU3RyZWFtLmNvbXB1dGVWaWRlb0NvbnN0cmFpbnRzKHtcbiAgICAgICAgICAgICAgICAuLi5kZWZhdWx0cyxcbiAgICAgICAgICAgICAgICAuLi5jb25zdHJhaW50cyxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIG5ldyBMb2NhbFN0cmVhbShzdHJlYW0sIHtcbiAgICAgICAgICAgIC4uLmRlZmF1bHRzLFxuICAgICAgICAgICAgLi4uY29uc3RyYWludHMsXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBzdGF0aWMgYXN5bmMgZ2V0RGlzcGxheU1lZGlhKGNvbnN0cmFpbnRzID0ge1xuICAgICAgICBjb2RlYzogJ3ZwOCcsXG4gICAgICAgIHJlc29sdXRpb246ICdoZCcsXG4gICAgICAgIGF1ZGlvOiBmYWxzZSxcbiAgICAgICAgdmlkZW86IHRydWUsXG4gICAgICAgIHNpbXVsY2FzdDogZmFsc2UsXG4gICAgfSkge1xuICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgIGNvbnN0IHN0cmVhbSA9IGF3YWl0IG5hdmlnYXRvci5tZWRpYURldmljZXMuZ2V0RGlzcGxheU1lZGlhKGNvbnN0cmFpbnRzKTtcbiAgICAgICAgcmV0dXJuIG5ldyBMb2NhbFN0cmVhbShzdHJlYW0sIHtcbiAgICAgICAgICAgIC4uLmRlZmF1bHRzLFxuICAgICAgICAgICAgLi4uY29uc3RyYWludHMsXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBzdGF0aWMgY29tcHV0ZUF1ZGlvQ29uc3RyYWludHMoY29uc3RyYWludHMpIHtcbiAgICAgICAgcmV0dXJuIGNvbnN0cmFpbnRzLmF1ZGlvO1xuICAgIH1cbiAgICBzdGF0aWMgY29tcHV0ZVZpZGVvQ29uc3RyYWludHMoY29uc3RyYWludHMpIHtcbiAgICAgICAgaWYgKGNvbnN0cmFpbnRzLnZpZGVvIGluc3RhbmNlb2YgT2JqZWN0KSB7XG4gICAgICAgICAgICByZXR1cm4gY29uc3RyYWludHMudmlkZW87XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoY29uc3RyYWludHMudmlkZW8gJiYgY29uc3RyYWludHMucmVzb2x1dGlvbikge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAuLi5leHBvcnRzLlZpZGVvQ29uc3RyYWludHNbY29uc3RyYWludHMucmVzb2x1dGlvbl0ucmVzb2x1dGlvbixcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGNvbnN0cmFpbnRzLnZpZGVvO1xuICAgIH1cbiAgICBnZXRUcmFjayhraW5kKSB7XG4gICAgICAgIGxldCB0cmFja3M7XG4gICAgICAgIGlmIChraW5kID09PSAndmlkZW8nKSB7XG4gICAgICAgICAgICB0cmFja3MgPSB0aGlzLmdldFZpZGVvVHJhY2tzKCk7XG4gICAgICAgICAgICByZXR1cm4gdHJhY2tzLmxlbmd0aCA+IDAgPyB0aGlzLmdldFZpZGVvVHJhY2tzKClbMF0gOiB1bmRlZmluZWQ7XG4gICAgICAgIH1cbiAgICAgICAgdHJhY2tzID0gdGhpcy5nZXRBdWRpb1RyYWNrcygpO1xuICAgICAgICByZXR1cm4gdHJhY2tzLmxlbmd0aCA+IDAgPyB0aGlzLmdldEF1ZGlvVHJhY2tzKClbMF0gOiB1bmRlZmluZWQ7XG4gICAgfVxuICAgIGFzeW5jIGdldE5ld1RyYWNrKGtpbmQpIHtcbiAgICAgICAgY29uc3Qgc3RyZWFtID0gYXdhaXQgbmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5nZXRVc2VyTWVkaWEoe1xuICAgICAgICAgICAgW2tpbmRdOiBraW5kID09PSAndmlkZW8nXG4gICAgICAgICAgICAgICAgPyBMb2NhbFN0cmVhbS5jb21wdXRlVmlkZW9Db25zdHJhaW50cyh0aGlzLmNvbnN0cmFpbnRzKVxuICAgICAgICAgICAgICAgIDogTG9jYWxTdHJlYW0uY29tcHV0ZUF1ZGlvQ29uc3RyYWludHModGhpcy5jb25zdHJhaW50cyksXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gc3RyZWFtLmdldFRyYWNrcygpWzBdO1xuICAgIH1cbiAgICBwdWJsaXNoVHJhY2sodHJhY2spIHtcbiAgICAgICAgaWYgKHRoaXMucGMpIHtcbiAgICAgICAgICAgIGNvbnN0IGluaXQgPSB7XG4gICAgICAgICAgICAgICAgc3RyZWFtczogW3RoaXNdLFxuICAgICAgICAgICAgICAgIGRpcmVjdGlvbjogJ3NlbmRvbmx5JyxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBpZiAodHJhY2sua2luZCA9PT0gJ3ZpZGVvJykge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmVuY29kaW5nUGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgICAgIGluaXQuc2VuZEVuY29kaW5ncyA9IHRoaXMuZW5jb2RpbmdQYXJhbXM7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMuY29uc3RyYWludHMuc2ltdWxjYXN0KSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGlkeCA9IHJlc29sdXRpb25zLmluZGV4T2YodGhpcy5jb25zdHJhaW50cy5yZXNvbHV0aW9uKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZW5jb2RpbmdzID0gW1xuICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJpZDogJ2YnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1heEJpdHJhdGU6IGV4cG9ydHMuVmlkZW9Db25zdHJhaW50c1tyZXNvbHV0aW9uc1tpZHhdXS5lbmNvZGluZ3MubWF4Qml0cmF0ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXhGcmFtZXJhdGU6IGV4cG9ydHMuVmlkZW9Db25zdHJhaW50c1tyZXNvbHV0aW9uc1tpZHhdXS5lbmNvZGluZ3MubWF4RnJhbWVyYXRlLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgXTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGlkeCAtIDEgPj0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RpbmdzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJpZDogJ2gnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjYWxlUmVzb2x1dGlvbkRvd25CeTogMi4wLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1heEJpdHJhdGU6IGV4cG9ydHMuVmlkZW9Db25zdHJhaW50c1tyZXNvbHV0aW9uc1tpZHggLSAxXV0uZW5jb2RpbmdzLm1heEJpdHJhdGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF4RnJhbWVyYXRlOiBleHBvcnRzLlZpZGVvQ29uc3RyYWludHNbcmVzb2x1dGlvbnNbaWR4IC0gMV1dLmVuY29kaW5ncy5tYXhGcmFtZXJhdGUsXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAoaWR4IC0gMiA+PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGluZ3MucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmlkOiAncScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NhbGVSZXNvbHV0aW9uRG93bkJ5OiA0LjAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF4Qml0cmF0ZTogZXhwb3J0cy5WaWRlb0NvbnN0cmFpbnRzW3Jlc29sdXRpb25zW2lkeCAtIDJdXS5lbmNvZGluZ3MubWF4Qml0cmF0ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXhGcmFtZXJhdGU6IGV4cG9ydHMuVmlkZW9Db25zdHJhaW50c1tyZXNvbHV0aW9uc1tpZHggLSAyXV0uZW5jb2RpbmdzLm1heEZyYW1lcmF0ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGluaXQuc2VuZEVuY29kaW5ncyA9IGVuY29kaW5ncztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGluaXQuc2VuZEVuY29kaW5ncyA9IFtleHBvcnRzLlZpZGVvQ29uc3RyYWludHNbdGhpcy5jb25zdHJhaW50cy5yZXNvbHV0aW9uXS5lbmNvZGluZ3NdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHRyYW5zY2VpdmVyID0gdGhpcy5wYy5hZGRUcmFuc2NlaXZlcih0cmFjaywgaW5pdCk7XG4gICAgICAgICAgICB0aGlzLnNldFByZWZlcnJlZENvZGVjKHRyYW5zY2VpdmVyLCB0cmFjay5raW5kKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBzZXRQcmVmZXJyZWRDb2RlYyh0cmFuc2NlaXZlciwga2luZCkge1xuICAgICAgICBpZiAoJ3NldENvZGVjUHJlZmVyZW5jZXMnIGluIHRyYW5zY2VpdmVyKSB7XG4gICAgICAgICAgICBjb25zdCBjYXAgPSBSVENSdHBTZW5kZXIuZ2V0Q2FwYWJpbGl0aWVzKGtpbmQpO1xuICAgICAgICAgICAgaWYgKCFjYXApXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgbGV0IHNlbENvZGVjO1xuICAgICAgICAgICAgaWYgKHRoaXMuY29uc3RyYWludHMucHJlZmVycmVkQ29kZWNQcm9maWxlICYmIGtpbmQgPT09ICd2aWRlbycpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBhbGxDb2RlY1Byb2ZpbGVzID0gY2FwLmNvZGVjcy5maWx0ZXIoKGMpID0+IGMubWltZVR5cGUudG9Mb3dlckNhc2UoKSA9PT0gYHZpZGVvLyR7dGhpcy5jb25zdHJhaW50cy5jb2RlYy50b0xvd2VyQ2FzZSgpfWApO1xuICAgICAgICAgICAgICAgIGlmICghYWxsQ29kZWNQcm9maWxlcykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHNlbENvZGVjID0gYWxsQ29kZWNQcm9maWxlcy5maW5kKChjKSA9PiB7IHZhciBfYTsgcmV0dXJuIGMuc2RwRm10cExpbmUgJiYgKChfYSA9IGMuc2RwRm10cExpbmUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5pbmRleE9mKGBwcm9maWxlLWxldmVsLWlkPSR7dGhpcy5jb25zdHJhaW50cy5wcmVmZXJyZWRDb2RlY1Byb2ZpbGV9YCkpID49IDA7IH0pO1xuICAgICAgICAgICAgICAgIGlmICghc2VsQ29kZWMpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gZ2V0IGZpcnN0IG9uZVxuICAgICAgICAgICAgICAgICAgICBzZWxDb2RlYyA9IGFsbENvZGVjUHJvZmlsZXNbMF07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgc2VsQ29kZWMgPSBjYXAuY29kZWNzLmZpbmQoKGMpID0+IGMubWltZVR5cGUudG9Mb3dlckNhc2UoKSA9PT0gYHZpZGVvLyR7dGhpcy5jb25zdHJhaW50cy5jb2RlYy50b0xvd2VyQ2FzZSgpfWAgfHxcbiAgICAgICAgICAgICAgICAgICAgYy5taW1lVHlwZS50b0xvd2VyQ2FzZSgpID09PSBgYXVkaW8vb3B1c2ApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHNlbENvZGVjKSB7XG4gICAgICAgICAgICAgICAgdHJhbnNjZWl2ZXIuc2V0Q29kZWNQcmVmZXJlbmNlcyhbc2VsQ29kZWNdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICB1cGRhdGVUcmFjayhuZXh0LCBwcmV2KSB7XG4gICAgICAgIHRoaXMuYWRkVHJhY2sobmV4dCk7XG4gICAgICAgIC8vIElmIHB1Ymxpc2hlZCwgcmVwbGFjZSBwdWJsaXNoZWQgdHJhY2sgd2l0aCB0cmFjayBmcm9tIG5ldyBkZXZpY2VcbiAgICAgICAgaWYgKHByZXYpIHtcbiAgICAgICAgICAgIHRoaXMucmVtb3ZlVHJhY2socHJldik7XG4gICAgICAgICAgICBwcmV2LnN0b3AoKTtcbiAgICAgICAgICAgIGlmICh0aGlzLnBjKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5wYy5nZXRTZW5kZXJzKCkuZm9yRWFjaChhc3luYyAoc2VuZGVyKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBfYSwgX2I7XG4gICAgICAgICAgICAgICAgICAgIGlmICgoKF9hID0gc2VuZGVyID09PSBudWxsIHx8IHNlbmRlciA9PT0gdm9pZCAwID8gdm9pZCAwIDogc2VuZGVyLnRyYWNrKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Eua2luZCkgPT09IG5leHQua2luZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgKF9iID0gc2VuZGVyLnRyYWNrKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Iuc3RvcCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VuZGVyLnJlcGxhY2VUcmFjayhuZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaWYgKHRoaXMucGMpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnB1Ymxpc2hUcmFjayhuZXh0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBpbml0QXVkaW9FbXB0eVRyYWNrKCkge1xuICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgIGNvbnN0IEF1ZGlvQ29udGV4dCA9IHdpbmRvdy5BdWRpb0NvbnRleHQgfHwgd2luZG93LndlYmtpdEF1ZGlvQ29udGV4dDtcbiAgICAgICAgY29uc3QgY3R4ID0gbmV3IEF1ZGlvQ29udGV4dCgpO1xuICAgICAgICBjb25zdCBvc2NpbGxhdG9yID0gY3R4LmNyZWF0ZU9zY2lsbGF0b3IoKTtcbiAgICAgICAgb3NjaWxsYXRvci5mcmVxdWVuY3kuc2V0VmFsdWVBdFRpbWUoMjAwMDAsIGN0eC5jdXJyZW50VGltZSk7XG4gICAgICAgIGNvbnN0IGRzdCA9IG9zY2lsbGF0b3IuY29ubmVjdChjdHguY3JlYXRlTWVkaWFTdHJlYW1EZXN0aW5hdGlvbigpKTtcbiAgICAgICAgb3NjaWxsYXRvci5zdGFydCgpO1xuICAgICAgICByZXR1cm4gZHN0LnN0cmVhbS5nZXRBdWRpb1RyYWNrcygpWzBdO1xuICAgIH1cbiAgICBpbml0VmlkZW9FbXB0eVRyYWNrKHdpZHRoLCBoZWlnaHQpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICBjb25zdCBjYW52YXMgPSBPYmplY3QuYXNzaWduKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpLCB7IHdpZHRoLCBoZWlnaHQgfSk7XG4gICAgICAgIChfYSA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZmlsbFJlY3QoMCwgMCwgd2lkdGgsIGhlaWdodCk7XG4gICAgICAgIGNvbnN0IHN0cmVhbSA9IGNhbnZhcy5jYXB0dXJlU3RyZWFtKCk7XG4gICAgICAgIHJldHVybiBzdHJlYW0uZ2V0VmlkZW9UcmFja3MoKVswXTtcbiAgICB9XG4gICAgcHVibGlzaCh0cmFuc3BvcnQsIGVuY29kaW5nUGFyYW1zKSB7XG4gICAgICAgIHRoaXMucGMgPSB0cmFuc3BvcnQucGM7XG4gICAgICAgIHRoaXMuYXBpID0gdHJhbnNwb3J0LmFwaTtcbiAgICAgICAgdGhpcy5lbmNvZGluZ1BhcmFtcyA9IGVuY29kaW5nUGFyYW1zO1xuICAgICAgICB0aGlzLmdldFRyYWNrcygpLmZvckVhY2godGhpcy5wdWJsaXNoVHJhY2suYmluZCh0aGlzKSk7XG4gICAgfVxuICAgIHVucHVibGlzaCgpIHtcbiAgICAgICAgaWYgKHRoaXMucGMpIHtcbiAgICAgICAgICAgIGNvbnN0IHRyYWNrcyA9IHRoaXMuZ2V0VHJhY2tzKCk7XG4gICAgICAgICAgICB0aGlzLnBjLmdldFNlbmRlcnMoKS5mb3JFYWNoKChzKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHMudHJhY2sgJiYgdHJhY2tzLmluY2x1ZGVzKHMudHJhY2spKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGMucmVtb3ZlVHJhY2socyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgYXN5bmMgc3dpdGNoRGV2aWNlKGtpbmQsIGRldmljZUlkKSB7XG4gICAgICAgIHRoaXMuY29uc3RyYWludHMgPSB7XG4gICAgICAgICAgICAuLi50aGlzLmNvbnN0cmFpbnRzLFxuICAgICAgICAgICAgW2tpbmRdOiB0aGlzLmNvbnN0cmFpbnRzW2tpbmRdIGluc3RhbmNlb2YgT2JqZWN0XG4gICAgICAgICAgICAgICAgPyB7XG4gICAgICAgICAgICAgICAgICAgIC4uLnRoaXMuY29uc3RyYWludHNba2luZF0sXG4gICAgICAgICAgICAgICAgICAgIGRldmljZUlkLFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICA6IHsgZGV2aWNlSWQgfSxcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgcHJldiA9IHRoaXMuZ2V0VHJhY2soa2luZCk7XG4gICAgICAgIC8vIEZpcmVmb3gvU2FmYXJpIGhhdmUgaXNzdWVzIHdoZW4gbXVsdGlwbGUgaW5wdXQgZGV2aWNlcyBhcmUgdXNlZCBieSBzYW1lIG9yaWdpbi4gV2UgbmVlZCB0byBzdG9wIHByZXZpb3VzIHRyYWNrIGJlZm9yZSBjcmVhdGluZyBuZXcgb25lLlxuICAgICAgICBpZiAocHJldilcbiAgICAgICAgICAgIHByZXYuc3RvcCgpO1xuICAgICAgICBjb25zdCBuZXh0ID0gYXdhaXQgdGhpcy5nZXROZXdUcmFjayhraW5kKTtcbiAgICAgICAgdGhpcy51cGRhdGVUcmFjayhuZXh0LCBwcmV2KTtcbiAgICB9XG4gICAgbXV0ZShraW5kKSB7XG4gICAgICAgIGNvbnN0IHRyYWNrID0gdGhpcy5nZXRUcmFjayhraW5kKTtcbiAgICAgICAgaWYgKHRyYWNrICYmIHRoaXMuY29uc3RyYWludHMuc2VuZEVtcHR5T25NdXRlKSB7XG4gICAgICAgICAgICBjb25zdCBlbXB0eVRyYWNrID0ga2luZCA9PT0gJ2F1ZGlvJ1xuICAgICAgICAgICAgICAgID8gdGhpcy5pbml0QXVkaW9FbXB0eVRyYWNrKClcbiAgICAgICAgICAgICAgICA6IHRoaXMuaW5pdFZpZGVvRW1wdHlUcmFjaygodHJhY2sgPT09IG51bGwgfHwgdHJhY2sgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHRyYWNrLmdldFNldHRpbmdzKCkud2lkdGgpIHx8IDY0MCwgKHRyYWNrID09PSBudWxsIHx8IHRyYWNrID09PSB2b2lkIDAgPyB2b2lkIDAgOiB0cmFjay5nZXRTZXR0aW5ncygpLmhlaWdodCkgfHwgMzYwKTtcbiAgICAgICAgICAgIGVtcHR5VHJhY2suZW5hYmxlZCA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy51cGRhdGVUcmFjayhlbXB0eVRyYWNrLCB0cmFjayk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRyYWNrKSB7XG4gICAgICAgICAgICB0cmFjay5zdG9wKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgYXN5bmMgdW5tdXRlKGtpbmQpIHtcbiAgICAgICAgY29uc3QgcHJldiA9IHRoaXMuZ2V0VHJhY2soa2luZCk7XG4gICAgICAgIGNvbnN0IHRyYWNrID0gYXdhaXQgdGhpcy5nZXROZXdUcmFjayhraW5kKTtcbiAgICAgICAgdGhpcy51cGRhdGVUcmFjayh0cmFjaywgcHJldik7XG4gICAgfVxuICAgIGFzeW5jIGVuYWJsZUxheWVycyhsYXllcnMpIHtcbiAgICAgICAgY29uc3QgY2FsbCA9IHtcbiAgICAgICAgICAgIHN0cmVhbUlkOiB0aGlzLmlkLFxuICAgICAgICAgICAgbGF5ZXJzLFxuICAgICAgICB9O1xuICAgICAgICBjb25zdCBjYWxsU3RyID0gSlNPTi5zdHJpbmdpZnkoY2FsbCk7XG4gICAgICAgIGlmICh0aGlzLmFwaSkge1xuICAgICAgICAgICAgaWYgKHRoaXMuYXBpLnJlYWR5U3RhdGUgIT09ICdvcGVuJykge1xuICAgICAgICAgICAgICAgIC8vIHF1ZXVlIGNhbGwgaWYgd2UgYXJlbid0IG9wZW4geWV0XG4gICAgICAgICAgICAgICAgdGhpcy5hcGkub25vcGVuID0gKCkgPT4geyB2YXIgX2E7IHJldHVybiAoX2EgPSB0aGlzLmFwaSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnNlbmQoSlNPTi5zdHJpbmdpZnkoY2FsbCkpOyB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5hcGkuc2VuZChKU09OLnN0cmluZ2lmeShjYWxsKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbGF5ZXJWYWx1ZXMgPSBbJ2hpZ2gnLCAnbWVkaXVtJywgJ2xvdyddO1xuICAgICAgICBhd2FpdCBQcm9taXNlLmFsbChsYXllclZhbHVlcy5tYXAoYXN5bmMgKGxheWVyKSA9PiB7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLnVwZGF0ZU1lZGlhRW5jb2RpbmdQYXJhbXMoeyBhY3RpdmU6IGxheWVycy5pbmNsdWRlcyhsYXllcikgfSwgbGF5ZXIpO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIGFzeW5jIHVwZGF0ZU1lZGlhRW5jb2RpbmdQYXJhbXMoZW5jb2RpbmdQYXJhbXMsIGxheWVyKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgaWYgKCF0aGlzLnBjKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBjb25zdCB0cmFja3MgPSB0aGlzLmdldFRyYWNrcygpO1xuICAgICAgICBhd2FpdCBQcm9taXNlLmFsbCgoX2EgPSB0aGlzLnBjKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZ2V0U2VuZGVycygpLmZpbHRlcigoc2VuZGVyKSA9PiBzZW5kZXIudHJhY2sgJiYgdHJhY2tzLmluY2x1ZGVzKHNlbmRlci50cmFjaykpLm1hcChhc3luYyAoc2VuZGVyKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBwYXJhbXMgPSBzZW5kZXIuZ2V0UGFyYW1ldGVycygpO1xuICAgICAgICAgICAgaWYgKCFwYXJhbXMuZW5jb2RpbmdzKSB7XG4gICAgICAgICAgICAgICAgcGFyYW1zLmVuY29kaW5ncyA9IFt7fV07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsZXQgaWR4ID0gMDtcbiAgICAgICAgICAgIGlmICh0aGlzLmNvbnN0cmFpbnRzLnNpbXVsY2FzdCAmJiBsYXllcikge1xuICAgICAgICAgICAgICAgIGNvbnN0IHJpZCA9IGxheWVyID09PSAnaGlnaCcgPyAnZicgOiBsYXllciA9PT0gJ21lZGl1bScgPyAnaCcgOiAncSc7XG4gICAgICAgICAgICAgICAgaWR4ID0gcGFyYW1zLmVuY29kaW5ncy5maW5kSW5kZXgoKGVuY29kaW5nKSA9PiBlbmNvZGluZy5yaWQgPT09IHJpZCk7XG4gICAgICAgICAgICAgICAgaWYgKHBhcmFtcy5lbmNvZGluZ3MubGVuZ3RoIDwgaWR4ICsgMSlcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcGFyYW1zLmVuY29kaW5nc1tpZHhdID0ge1xuICAgICAgICAgICAgICAgIC4uLnBhcmFtcy5lbmNvZGluZ3NbaWR4XSxcbiAgICAgICAgICAgICAgICAuLi5lbmNvZGluZ1BhcmFtcyxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBhd2FpdCBzZW5kZXIuc2V0UGFyYW1ldGVycyhwYXJhbXMpO1xuICAgICAgICB9KSk7XG4gICAgfVxufVxuZXhwb3J0cy5Mb2NhbFN0cmVhbSA9IExvY2FsU3RyZWFtO1xuZnVuY3Rpb24gbWFrZVJlbW90ZShzdHJlYW0sIHRyYW5zcG9ydCkge1xuICAgIGNvbnN0IHJlbW90ZSA9IHN0cmVhbTtcbiAgICByZW1vdGUuYXVkaW8gPSB0cnVlO1xuICAgIHJlbW90ZS52aWRlbyA9ICdub25lJztcbiAgICByZW1vdGUuZnJhbWVyYXRlID0gJ2hpZ2gnO1xuICAgIHJlbW90ZS5fdmlkZW9QcmVNdXRlID0gJ2hpZ2gnO1xuICAgIGNvbnN0IHNlbGVjdCA9ICgpID0+IHtcbiAgICAgICAgY29uc3QgY2FsbCA9IHtcbiAgICAgICAgICAgIHN0cmVhbUlkOiByZW1vdGUuaWQsXG4gICAgICAgICAgICB2aWRlbzogcmVtb3RlLnZpZGVvLFxuICAgICAgICAgICAgYXVkaW86IHJlbW90ZS5hdWRpbyxcbiAgICAgICAgICAgIGZyYW1lcmF0ZTogcmVtb3RlLmZyYW1lcmF0ZSxcbiAgICAgICAgfTtcbiAgICAgICAgaWYgKHRyYW5zcG9ydC5hcGkpIHtcbiAgICAgICAgICAgIGlmICh0cmFuc3BvcnQuYXBpLnJlYWR5U3RhdGUgIT09ICdvcGVuJykge1xuICAgICAgICAgICAgICAgIC8vIHF1ZXVlIGNhbGwgaWYgd2UgYXJlbid0IG9wZW4geWV0XG4gICAgICAgICAgICAgICAgdHJhbnNwb3J0LmFwaS5vbm9wZW4gPSAoKSA9PiB7IHZhciBfYTsgcmV0dXJuIChfYSA9IHRyYW5zcG9ydC5hcGkpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zZW5kKEpTT04uc3RyaW5naWZ5KGNhbGwpKTsgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRyYW5zcG9ydC5hcGkuc2VuZChKU09OLnN0cmluZ2lmeShjYWxsKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xuICAgIHJlbW90ZS5wcmVmZXJMYXllciA9IChsYXllcikgPT4ge1xuICAgICAgICByZW1vdGUudmlkZW8gPSBsYXllcjtcbiAgICAgICAgc2VsZWN0KCk7XG4gICAgfTtcbiAgICByZW1vdGUucHJlZmVyRnJhbWVyYXRlID0gKGxheWVyKSA9PiB7XG4gICAgICAgIHJlbW90ZS5mcmFtZXJhdGUgPSBsYXllcjtcbiAgICAgICAgc2VsZWN0KCk7XG4gICAgfTtcbiAgICByZW1vdGUubXV0ZSA9IChraW5kKSA9PiB7XG4gICAgICAgIGlmIChraW5kID09PSAnYXVkaW8nKSB7XG4gICAgICAgICAgICByZW1vdGUuYXVkaW8gPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChraW5kID09PSAndmlkZW8nKSB7XG4gICAgICAgICAgICByZW1vdGUuX3ZpZGVvUHJlTXV0ZSA9IHJlbW90ZS52aWRlbztcbiAgICAgICAgICAgIHJlbW90ZS52aWRlbyA9ICdub25lJztcbiAgICAgICAgfVxuICAgICAgICBzZWxlY3QoKTtcbiAgICB9O1xuICAgIHJlbW90ZS51bm11dGUgPSAoa2luZCkgPT4ge1xuICAgICAgICBpZiAoa2luZCA9PT0gJ2F1ZGlvJykge1xuICAgICAgICAgICAgcmVtb3RlLmF1ZGlvID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChraW5kID09PSAndmlkZW8nKSB7XG4gICAgICAgICAgICByZW1vdGUudmlkZW8gPSByZW1vdGUuX3ZpZGVvUHJlTXV0ZTtcbiAgICAgICAgfVxuICAgICAgICBzZWxlY3QoKTtcbiAgICB9O1xuICAgIHJldHVybiByZW1vdGU7XG59XG5leHBvcnRzLm1ha2VSZW1vdGUgPSBtYWtlUmVtb3RlO1xuIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///0\n")},function(module,exports,__webpack_require__){"use strict";eval('\nObject.defineProperty(exports, "__esModule", { value: true });\nexports.LocalStream = exports.Client = void 0;\nconst client_1 = __webpack_require__(2);\nexports.Client = client_1.default;\nconst stream_1 = __webpack_require__(0);\nObject.defineProperty(exports, "LocalStream", { enumerable: true, get: function () { return stream_1.LocalStream; } });\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9Jb25TREsvLi9zcmMvaW5kZXgudHM/NzFiZCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE4QyxjQUFjO0FBQzVEO0FBQ0EsaUJBQWlCLG1CQUFPLENBQUMsQ0FBVTtBQUNuQztBQUNBLGlCQUFpQixtQkFBTyxDQUFDLENBQVU7QUFDbkMsK0NBQStDLHFDQUFxQyw2QkFBNkIsRUFBRSxFQUFFIiwiZmlsZSI6IjEuanMiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuTG9jYWxTdHJlYW0gPSBleHBvcnRzLkNsaWVudCA9IHZvaWQgMDtcbmNvbnN0IGNsaWVudF8xID0gcmVxdWlyZShcIi4vY2xpZW50XCIpO1xuZXhwb3J0cy5DbGllbnQgPSBjbGllbnRfMS5kZWZhdWx0O1xuY29uc3Qgc3RyZWFtXzEgPSByZXF1aXJlKFwiLi9zdHJlYW1cIik7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJMb2NhbFN0cmVhbVwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gc3RyZWFtXzEuTG9jYWxTdHJlYW07IH0gfSk7XG4iXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///1\n')},function(module,exports,__webpack_require__){"use strict";eval("\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Transport = void 0;\nconst stream_1 = __webpack_require__(0);\nconst API_CHANNEL = 'ion-sfu';\nconst ERR_NO_SESSION = 'no active session, join first';\nvar Role;\n(function (Role) {\n    Role[Role[\"pub\"] = 0] = \"pub\";\n    Role[Role[\"sub\"] = 1] = \"sub\";\n})(Role || (Role = {}));\nclass Transport {\n    constructor(role, signal, config) {\n        this.signal = signal;\n        this.pc = new RTCPeerConnection(config);\n        this.candidates = [];\n        if (role === Role.pub) {\n            this.pc.createDataChannel(API_CHANNEL);\n        }\n        this.pc.onicecandidate = ({ candidate }) => {\n            if (candidate) {\n                this.signal.trickle({ target: role, candidate });\n            }\n        };\n        this.pc.oniceconnectionstatechange = async (e) => {\n            if (this.pc.iceConnectionState === 'disconnected') {\n                if (this.pc.restartIce !== undefined) {\n                    // this will trigger onNegotiationNeeded\n                    this.pc.restartIce();\n                }\n            }\n        };\n    }\n}\nexports.Transport = Transport;\nclass Client {\n    constructor(signal, config = {\n        codec: 'vp8',\n        iceServers: [\n            {\n                urls: ['stun:stun.l.google.com:19302', 'stun:stun1.l.google.com:19302'],\n            },\n        ],\n    }) {\n        this.signal = signal;\n        this.config = config;\n        signal.onnegotiate = this.negotiate.bind(this);\n        signal.ontrickle = this.trickle.bind(this);\n    }\n    async join(sid, uid) {\n        this.transports = {\n            [Role.pub]: new Transport(Role.pub, this.signal, this.config),\n            [Role.sub]: new Transport(Role.sub, this.signal, this.config),\n        };\n        this.transports[Role.sub].pc.ontrack = (ev) => {\n            const stream = ev.streams[0];\n            const remote = stream_1.makeRemote(stream, this.transports[Role.sub]);\n            if (this.ontrack) {\n                this.ontrack(ev.track, remote);\n            }\n        };\n        const apiReady = new Promise((resolve) => {\n            this.transports[Role.sub].pc.ondatachannel = (ev) => {\n                if (ev.channel.label === API_CHANNEL) {\n                    this.transports[Role.sub].api = ev.channel;\n                    this.transports[Role.pub].api = ev.channel;\n                    ev.channel.onmessage = (e) => {\n                        try {\n                            const msg = JSON.parse(e.data);\n                            this.processChannelMessage(msg);\n                        }\n                        catch (err) {\n                            /* tslint:disable-next-line:no-console */\n                            console.error(err);\n                        }\n                    };\n                    resolve();\n                    return;\n                }\n                if (this.ondatachannel) {\n                    this.ondatachannel(ev);\n                }\n            };\n        });\n        const offer = await this.transports[Role.pub].pc.createOffer();\n        await this.transports[Role.pub].pc.setLocalDescription(offer);\n        const answer = await this.signal.join(sid, uid, offer);\n        await this.transports[Role.pub].pc.setRemoteDescription(answer);\n        this.transports[Role.pub].candidates.forEach((c) => this.transports[Role.pub].pc.addIceCandidate(c));\n        this.transports[Role.pub].pc.onnegotiationneeded = this.onNegotiationNeeded.bind(this);\n        return apiReady;\n    }\n    leave() {\n        if (this.transports) {\n            Object.values(this.transports).forEach((t) => t.pc.close());\n            delete this.transports;\n        }\n    }\n    getPubStats(selector) {\n        if (!this.transports) {\n            throw Error(ERR_NO_SESSION);\n        }\n        return this.transports[Role.pub].pc.getStats(selector);\n    }\n    getSubStats(selector) {\n        if (!this.transports) {\n            throw Error(ERR_NO_SESSION);\n        }\n        return this.transports[Role.sub].pc.getStats(selector);\n    }\n    publish(stream, encodingParams) {\n        if (!this.transports) {\n            throw Error(ERR_NO_SESSION);\n        }\n        stream.publish(this.transports[Role.pub], encodingParams);\n    }\n    restartIce() {\n        this.renegotiate(true);\n    }\n    createDataChannel(label) {\n        if (!this.transports) {\n            throw Error(ERR_NO_SESSION);\n        }\n        return this.transports[Role.pub].pc.createDataChannel(label);\n    }\n    close() {\n        if (this.transports) {\n            Object.values(this.transports).forEach((t) => t.pc.close());\n        }\n        this.signal.close();\n    }\n    trickle({ candidate, target }) {\n        if (!this.transports) {\n            throw Error(ERR_NO_SESSION);\n        }\n        if (this.transports[target].pc.remoteDescription) {\n            this.transports[target].pc.addIceCandidate(candidate);\n        }\n        else {\n            this.transports[target].candidates.push(candidate);\n        }\n    }\n    async negotiate(description) {\n        if (!this.transports) {\n            throw Error(ERR_NO_SESSION);\n        }\n        let answer;\n        try {\n            await this.transports[Role.sub].pc.setRemoteDescription(description);\n            this.transports[Role.sub].candidates.forEach((c) => this.transports[Role.sub].pc.addIceCandidate(c));\n            this.transports[Role.sub].candidates = [];\n            answer = await this.transports[Role.sub].pc.createAnswer();\n            await this.transports[Role.sub].pc.setLocalDescription(answer);\n            this.signal.answer(answer);\n        }\n        catch (err) {\n            /* tslint:disable-next-line:no-console */\n            console.error(err);\n            if (this.onerrnegotiate)\n                this.onerrnegotiate(Role.sub, err, description, answer);\n        }\n    }\n    onNegotiationNeeded() {\n        this.renegotiate(false);\n    }\n    async renegotiate(iceRestart) {\n        if (!this.transports) {\n            throw Error(ERR_NO_SESSION);\n        }\n        let offer;\n        let answer;\n        try {\n            offer = await this.transports[Role.pub].pc.createOffer({ iceRestart });\n            await this.transports[Role.pub].pc.setLocalDescription(offer);\n            answer = await this.signal.offer(offer);\n            await this.transports[Role.pub].pc.setRemoteDescription(answer);\n        }\n        catch (err) {\n            /* tslint:disable-next-line:no-console */\n            console.error(err);\n            if (this.onerrnegotiate)\n                this.onerrnegotiate(Role.pub, err, offer, answer);\n        }\n    }\n    processChannelMessage(msg) {\n        if (msg.method !== undefined && msg.params !== undefined) {\n            switch (msg.method) {\n                case 'audioLevels':\n                    if (this.onspeaker) {\n                        this.onspeaker(msg.params);\n                    }\n                    break;\n                case 'activeLayer':\n                    if (this.onactivelayer) {\n                        this.onactivelayer(msg.params);\n                    }\n                    break;\n                default:\n                // do nothing\n            }\n        }\n        else {\n            // legacy channel message - payload contains audio levels\n            if (this.onspeaker) {\n                this.onspeaker(msg);\n            }\n        }\n    }\n}\nexports.default = Client;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9Jb25TREsvLi9zcmMvY2xpZW50LnRzP2U3MWIiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBOEMsY0FBYztBQUM1RDtBQUNBLGlCQUFpQixtQkFBTyxDQUFDLENBQVU7QUFDbkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQyxvQkFBb0I7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1DQUFtQyxZQUFZO0FBQy9DO0FBQ0EscUNBQXFDLDBCQUEwQjtBQUMvRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWEsb0JBQW9CO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0VBQW9FLGFBQWE7QUFDakY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiMi5qcyIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5UcmFuc3BvcnQgPSB2b2lkIDA7XG5jb25zdCBzdHJlYW1fMSA9IHJlcXVpcmUoXCIuL3N0cmVhbVwiKTtcbmNvbnN0IEFQSV9DSEFOTkVMID0gJ2lvbi1zZnUnO1xuY29uc3QgRVJSX05PX1NFU1NJT04gPSAnbm8gYWN0aXZlIHNlc3Npb24sIGpvaW4gZmlyc3QnO1xudmFyIFJvbGU7XG4oZnVuY3Rpb24gKFJvbGUpIHtcbiAgICBSb2xlW1JvbGVbXCJwdWJcIl0gPSAwXSA9IFwicHViXCI7XG4gICAgUm9sZVtSb2xlW1wic3ViXCJdID0gMV0gPSBcInN1YlwiO1xufSkoUm9sZSB8fCAoUm9sZSA9IHt9KSk7XG5jbGFzcyBUcmFuc3BvcnQge1xuICAgIGNvbnN0cnVjdG9yKHJvbGUsIHNpZ25hbCwgY29uZmlnKSB7XG4gICAgICAgIHRoaXMuc2lnbmFsID0gc2lnbmFsO1xuICAgICAgICB0aGlzLnBjID0gbmV3IFJUQ1BlZXJDb25uZWN0aW9uKGNvbmZpZyk7XG4gICAgICAgIHRoaXMuY2FuZGlkYXRlcyA9IFtdO1xuICAgICAgICBpZiAocm9sZSA9PT0gUm9sZS5wdWIpIHtcbiAgICAgICAgICAgIHRoaXMucGMuY3JlYXRlRGF0YUNoYW5uZWwoQVBJX0NIQU5ORUwpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMucGMub25pY2VjYW5kaWRhdGUgPSAoeyBjYW5kaWRhdGUgfSkgPT4ge1xuICAgICAgICAgICAgaWYgKGNhbmRpZGF0ZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuc2lnbmFsLnRyaWNrbGUoeyB0YXJnZXQ6IHJvbGUsIGNhbmRpZGF0ZSB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5wYy5vbmljZWNvbm5lY3Rpb25zdGF0ZWNoYW5nZSA9IGFzeW5jIChlKSA9PiB7XG4gICAgICAgICAgICBpZiAodGhpcy5wYy5pY2VDb25uZWN0aW9uU3RhdGUgPT09ICdkaXNjb25uZWN0ZWQnKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMucGMucmVzdGFydEljZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIHRoaXMgd2lsbCB0cmlnZ2VyIG9uTmVnb3RpYXRpb25OZWVkZWRcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYy5yZXN0YXJ0SWNlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH1cbn1cbmV4cG9ydHMuVHJhbnNwb3J0ID0gVHJhbnNwb3J0O1xuY2xhc3MgQ2xpZW50IHtcbiAgICBjb25zdHJ1Y3RvcihzaWduYWwsIGNvbmZpZyA9IHtcbiAgICAgICAgY29kZWM6ICd2cDgnLFxuICAgICAgICBpY2VTZXJ2ZXJzOiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdXJsczogWydzdHVuOnN0dW4ubC5nb29nbGUuY29tOjE5MzAyJywgJ3N0dW46c3R1bjEubC5nb29nbGUuY29tOjE5MzAyJ10sXG4gICAgICAgICAgICB9LFxuICAgICAgICBdLFxuICAgIH0pIHtcbiAgICAgICAgdGhpcy5zaWduYWwgPSBzaWduYWw7XG4gICAgICAgIHRoaXMuY29uZmlnID0gY29uZmlnO1xuICAgICAgICBzaWduYWwub25uZWdvdGlhdGUgPSB0aGlzLm5lZ290aWF0ZS5iaW5kKHRoaXMpO1xuICAgICAgICBzaWduYWwub250cmlja2xlID0gdGhpcy50cmlja2xlLmJpbmQodGhpcyk7XG4gICAgfVxuICAgIGFzeW5jIGpvaW4oc2lkLCB1aWQpIHtcbiAgICAgICAgdGhpcy50cmFuc3BvcnRzID0ge1xuICAgICAgICAgICAgW1JvbGUucHViXTogbmV3IFRyYW5zcG9ydChSb2xlLnB1YiwgdGhpcy5zaWduYWwsIHRoaXMuY29uZmlnKSxcbiAgICAgICAgICAgIFtSb2xlLnN1Yl06IG5ldyBUcmFuc3BvcnQoUm9sZS5zdWIsIHRoaXMuc2lnbmFsLCB0aGlzLmNvbmZpZyksXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMudHJhbnNwb3J0c1tSb2xlLnN1Yl0ucGMub250cmFjayA9IChldikgPT4ge1xuICAgICAgICAgICAgY29uc3Qgc3RyZWFtID0gZXYuc3RyZWFtc1swXTtcbiAgICAgICAgICAgIGNvbnN0IHJlbW90ZSA9IHN0cmVhbV8xLm1ha2VSZW1vdGUoc3RyZWFtLCB0aGlzLnRyYW5zcG9ydHNbUm9sZS5zdWJdKTtcbiAgICAgICAgICAgIGlmICh0aGlzLm9udHJhY2spIHtcbiAgICAgICAgICAgICAgICB0aGlzLm9udHJhY2soZXYudHJhY2ssIHJlbW90ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IGFwaVJlYWR5ID0gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICAgICAgICAgIHRoaXMudHJhbnNwb3J0c1tSb2xlLnN1Yl0ucGMub25kYXRhY2hhbm5lbCA9IChldikgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChldi5jaGFubmVsLmxhYmVsID09PSBBUElfQ0hBTk5FTCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnRyYW5zcG9ydHNbUm9sZS5zdWJdLmFwaSA9IGV2LmNoYW5uZWw7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudHJhbnNwb3J0c1tSb2xlLnB1Yl0uYXBpID0gZXYuY2hhbm5lbDtcbiAgICAgICAgICAgICAgICAgICAgZXYuY2hhbm5lbC5vbm1lc3NhZ2UgPSAoZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBtc2cgPSBKU09OLnBhcnNlKGUuZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wcm9jZXNzQ2hhbm5lbE1lc3NhZ2UobXNnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKiB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8tY29uc29sZSAqL1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICh0aGlzLm9uZGF0YWNoYW5uZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vbmRhdGFjaGFubmVsKGV2KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICB9KTtcbiAgICAgICAgY29uc3Qgb2ZmZXIgPSBhd2FpdCB0aGlzLnRyYW5zcG9ydHNbUm9sZS5wdWJdLnBjLmNyZWF0ZU9mZmVyKCk7XG4gICAgICAgIGF3YWl0IHRoaXMudHJhbnNwb3J0c1tSb2xlLnB1Yl0ucGMuc2V0TG9jYWxEZXNjcmlwdGlvbihvZmZlcik7XG4gICAgICAgIGNvbnN0IGFuc3dlciA9IGF3YWl0IHRoaXMuc2lnbmFsLmpvaW4oc2lkLCB1aWQsIG9mZmVyKTtcbiAgICAgICAgYXdhaXQgdGhpcy50cmFuc3BvcnRzW1JvbGUucHViXS5wYy5zZXRSZW1vdGVEZXNjcmlwdGlvbihhbnN3ZXIpO1xuICAgICAgICB0aGlzLnRyYW5zcG9ydHNbUm9sZS5wdWJdLmNhbmRpZGF0ZXMuZm9yRWFjaCgoYykgPT4gdGhpcy50cmFuc3BvcnRzW1JvbGUucHViXS5wYy5hZGRJY2VDYW5kaWRhdGUoYykpO1xuICAgICAgICB0aGlzLnRyYW5zcG9ydHNbUm9sZS5wdWJdLnBjLm9ubmVnb3RpYXRpb25uZWVkZWQgPSB0aGlzLm9uTmVnb3RpYXRpb25OZWVkZWQuYmluZCh0aGlzKTtcbiAgICAgICAgcmV0dXJuIGFwaVJlYWR5O1xuICAgIH1cbiAgICBsZWF2ZSgpIHtcbiAgICAgICAgaWYgKHRoaXMudHJhbnNwb3J0cykge1xuICAgICAgICAgICAgT2JqZWN0LnZhbHVlcyh0aGlzLnRyYW5zcG9ydHMpLmZvckVhY2goKHQpID0+IHQucGMuY2xvc2UoKSk7XG4gICAgICAgICAgICBkZWxldGUgdGhpcy50cmFuc3BvcnRzO1xuICAgICAgICB9XG4gICAgfVxuICAgIGdldFB1YlN0YXRzKHNlbGVjdG9yKSB7XG4gICAgICAgIGlmICghdGhpcy50cmFuc3BvcnRzKSB7XG4gICAgICAgICAgICB0aHJvdyBFcnJvcihFUlJfTk9fU0VTU0lPTik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMudHJhbnNwb3J0c1tSb2xlLnB1Yl0ucGMuZ2V0U3RhdHMoc2VsZWN0b3IpO1xuICAgIH1cbiAgICBnZXRTdWJTdGF0cyhzZWxlY3Rvcikge1xuICAgICAgICBpZiAoIXRoaXMudHJhbnNwb3J0cykge1xuICAgICAgICAgICAgdGhyb3cgRXJyb3IoRVJSX05PX1NFU1NJT04pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLnRyYW5zcG9ydHNbUm9sZS5zdWJdLnBjLmdldFN0YXRzKHNlbGVjdG9yKTtcbiAgICB9XG4gICAgcHVibGlzaChzdHJlYW0sIGVuY29kaW5nUGFyYW1zKSB7XG4gICAgICAgIGlmICghdGhpcy50cmFuc3BvcnRzKSB7XG4gICAgICAgICAgICB0aHJvdyBFcnJvcihFUlJfTk9fU0VTU0lPTik7XG4gICAgICAgIH1cbiAgICAgICAgc3RyZWFtLnB1Ymxpc2godGhpcy50cmFuc3BvcnRzW1JvbGUucHViXSwgZW5jb2RpbmdQYXJhbXMpO1xuICAgIH1cbiAgICByZXN0YXJ0SWNlKCkge1xuICAgICAgICB0aGlzLnJlbmVnb3RpYXRlKHRydWUpO1xuICAgIH1cbiAgICBjcmVhdGVEYXRhQ2hhbm5lbChsYWJlbCkge1xuICAgICAgICBpZiAoIXRoaXMudHJhbnNwb3J0cykge1xuICAgICAgICAgICAgdGhyb3cgRXJyb3IoRVJSX05PX1NFU1NJT04pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLnRyYW5zcG9ydHNbUm9sZS5wdWJdLnBjLmNyZWF0ZURhdGFDaGFubmVsKGxhYmVsKTtcbiAgICB9XG4gICAgY2xvc2UoKSB7XG4gICAgICAgIGlmICh0aGlzLnRyYW5zcG9ydHMpIHtcbiAgICAgICAgICAgIE9iamVjdC52YWx1ZXModGhpcy50cmFuc3BvcnRzKS5mb3JFYWNoKCh0KSA9PiB0LnBjLmNsb3NlKCkpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc2lnbmFsLmNsb3NlKCk7XG4gICAgfVxuICAgIHRyaWNrbGUoeyBjYW5kaWRhdGUsIHRhcmdldCB9KSB7XG4gICAgICAgIGlmICghdGhpcy50cmFuc3BvcnRzKSB7XG4gICAgICAgICAgICB0aHJvdyBFcnJvcihFUlJfTk9fU0VTU0lPTik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMudHJhbnNwb3J0c1t0YXJnZXRdLnBjLnJlbW90ZURlc2NyaXB0aW9uKSB7XG4gICAgICAgICAgICB0aGlzLnRyYW5zcG9ydHNbdGFyZ2V0XS5wYy5hZGRJY2VDYW5kaWRhdGUoY2FuZGlkYXRlKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMudHJhbnNwb3J0c1t0YXJnZXRdLmNhbmRpZGF0ZXMucHVzaChjYW5kaWRhdGUpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGFzeW5jIG5lZ290aWF0ZShkZXNjcmlwdGlvbikge1xuICAgICAgICBpZiAoIXRoaXMudHJhbnNwb3J0cykge1xuICAgICAgICAgICAgdGhyb3cgRXJyb3IoRVJSX05PX1NFU1NJT04pO1xuICAgICAgICB9XG4gICAgICAgIGxldCBhbnN3ZXI7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLnRyYW5zcG9ydHNbUm9sZS5zdWJdLnBjLnNldFJlbW90ZURlc2NyaXB0aW9uKGRlc2NyaXB0aW9uKTtcbiAgICAgICAgICAgIHRoaXMudHJhbnNwb3J0c1tSb2xlLnN1Yl0uY2FuZGlkYXRlcy5mb3JFYWNoKChjKSA9PiB0aGlzLnRyYW5zcG9ydHNbUm9sZS5zdWJdLnBjLmFkZEljZUNhbmRpZGF0ZShjKSk7XG4gICAgICAgICAgICB0aGlzLnRyYW5zcG9ydHNbUm9sZS5zdWJdLmNhbmRpZGF0ZXMgPSBbXTtcbiAgICAgICAgICAgIGFuc3dlciA9IGF3YWl0IHRoaXMudHJhbnNwb3J0c1tSb2xlLnN1Yl0ucGMuY3JlYXRlQW5zd2VyKCk7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLnRyYW5zcG9ydHNbUm9sZS5zdWJdLnBjLnNldExvY2FsRGVzY3JpcHRpb24oYW5zd2VyKTtcbiAgICAgICAgICAgIHRoaXMuc2lnbmFsLmFuc3dlcihhbnN3ZXIpO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgIC8qIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1jb25zb2xlICovXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XG4gICAgICAgICAgICBpZiAodGhpcy5vbmVycm5lZ290aWF0ZSlcbiAgICAgICAgICAgICAgICB0aGlzLm9uZXJybmVnb3RpYXRlKFJvbGUuc3ViLCBlcnIsIGRlc2NyaXB0aW9uLCBhbnN3ZXIpO1xuICAgICAgICB9XG4gICAgfVxuICAgIG9uTmVnb3RpYXRpb25OZWVkZWQoKSB7XG4gICAgICAgIHRoaXMucmVuZWdvdGlhdGUoZmFsc2UpO1xuICAgIH1cbiAgICBhc3luYyByZW5lZ290aWF0ZShpY2VSZXN0YXJ0KSB7XG4gICAgICAgIGlmICghdGhpcy50cmFuc3BvcnRzKSB7XG4gICAgICAgICAgICB0aHJvdyBFcnJvcihFUlJfTk9fU0VTU0lPTik7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IG9mZmVyO1xuICAgICAgICBsZXQgYW5zd2VyO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgb2ZmZXIgPSBhd2FpdCB0aGlzLnRyYW5zcG9ydHNbUm9sZS5wdWJdLnBjLmNyZWF0ZU9mZmVyKHsgaWNlUmVzdGFydCB9KTtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMudHJhbnNwb3J0c1tSb2xlLnB1Yl0ucGMuc2V0TG9jYWxEZXNjcmlwdGlvbihvZmZlcik7XG4gICAgICAgICAgICBhbnN3ZXIgPSBhd2FpdCB0aGlzLnNpZ25hbC5vZmZlcihvZmZlcik7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLnRyYW5zcG9ydHNbUm9sZS5wdWJdLnBjLnNldFJlbW90ZURlc2NyaXB0aW9uKGFuc3dlcik7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgLyogdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLWNvbnNvbGUgKi9cbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgICAgICAgICAgIGlmICh0aGlzLm9uZXJybmVnb3RpYXRlKVxuICAgICAgICAgICAgICAgIHRoaXMub25lcnJuZWdvdGlhdGUoUm9sZS5wdWIsIGVyciwgb2ZmZXIsIGFuc3dlcik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcHJvY2Vzc0NoYW5uZWxNZXNzYWdlKG1zZykge1xuICAgICAgICBpZiAobXNnLm1ldGhvZCAhPT0gdW5kZWZpbmVkICYmIG1zZy5wYXJhbXMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgc3dpdGNoIChtc2cubWV0aG9kKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnYXVkaW9MZXZlbHMnOlxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5vbnNwZWFrZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub25zcGVha2VyKG1zZy5wYXJhbXMpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgJ2FjdGl2ZUxheWVyJzpcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMub25hY3RpdmVsYXllcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vbmFjdGl2ZWxheWVyKG1zZy5wYXJhbXMpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgLy8gZG8gbm90aGluZ1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgLy8gbGVnYWN5IGNoYW5uZWwgbWVzc2FnZSAtIHBheWxvYWQgY29udGFpbnMgYXVkaW8gbGV2ZWxzXG4gICAgICAgICAgICBpZiAodGhpcy5vbnNwZWFrZXIpIHtcbiAgICAgICAgICAgICAgICB0aGlzLm9uc3BlYWtlcihtc2cpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufVxuZXhwb3J0cy5kZWZhdWx0ID0gQ2xpZW50O1xuIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///2\n")}]);